var app=function(){"use strict";function t(){}function n(t){return t()}function e(){return Object.create(null)}function o(t){t.forEach(n)}function r(t){return"function"==typeof t}function c(t,n){return t!=t?n==n:t!==n||t&&"object"==typeof t||"function"==typeof t}let i,s;function a(t,n){t.appendChild(n)}function u(t,n,e){t.insertBefore(n,e||null)}function l(t){t.parentNode&&t.parentNode.removeChild(t)}function f(t){return document.createElement(t)}function p(t){return document.createTextNode(t)}function d(){return p(" ")}function h(t,n,e){null==e?t.removeAttribute(n):t.getAttribute(n)!==e&&t.setAttribute(n,e)}function m(t,n){n=""+n,t.data!==n&&(t.data=n)}function g(t,n){t.value=null==n?"":n}function $(t,n,e,o){null===e?t.style.removeProperty(n):t.style.setProperty(n,e,o?"important":"")}function y(t){s=t}const x=[],b=[];let v=[];const w=[],_=Promise.resolve();let k=!1;function E(t){v.push(t)}const j=new Set;let C=0;function S(){if(0!==C)return;const t=s;do{try{for(;C<x.length;){const t=x[C];C++,y(t),P(t.$$)}}catch(t){throw x.length=0,C=0,t}for(y(null),x.length=0,C=0;b.length;)b.pop()();for(let t=0;t<v.length;t+=1){const n=v[t];j.has(n)||(j.add(n),n())}v.length=0}while(x.length);for(;w.length;)w.pop()();k=!1,j.clear(),y(t)}function P(t){if(null!==t.fragment){t.update(),o(t.before_update);const n=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,n),t.after_update.forEach(E)}}const A=new Set;function O(t,n){const e=t.$$;null!==e.fragment&&(!function(t){const n=[],e=[];v.forEach((o=>-1===t.indexOf(o)?n.push(o):e.push(o))),e.forEach((t=>t())),v=n}(e.after_update),o(e.on_destroy),e.fragment&&e.fragment.d(n),e.on_destroy=e.fragment=null,e.ctx=[])}function L(t,n){-1===t.$$.dirty[0]&&(x.push(t),k||(k=!0,_.then(S)),t.$$.dirty.fill(0)),t.$$.dirty[n/31|0]|=1<<n%31}function N(c,i,a,u,f,p,d,h=[-1]){const m=s;y(c);const g=c.$$={fragment:null,ctx:[],props:p,update:t,not_equal:f,bound:e(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(i.context||(m?m.$$.context:[])),callbacks:e(),dirty:h,skip_bound:!1,root:i.target||m.$$.root};d&&d(g.root);let $=!1;if(g.ctx=a?a(c,i.props||{},((t,n,...e)=>{const o=e.length?e[0]:n;return g.ctx&&f(g.ctx[t],g.ctx[t]=o)&&(!g.skip_bound&&g.bound[t]&&g.bound[t](o),$&&L(c,t)),n})):[],g.update(),$=!0,o(g.before_update),g.fragment=!!u&&u(g.ctx),i.target){if(i.hydrate){const t=function(t){return Array.from(t.childNodes)}(i.target);g.fragment&&g.fragment.l(t),t.forEach(l)}else g.fragment&&g.fragment.c();i.intro&&((x=c.$$.fragment)&&x.i&&(A.delete(x),x.i(b))),function(t,e,c,i){const{fragment:s,after_update:a}=t.$$;s&&s.m(e,c),i||E((()=>{const e=t.$$.on_mount.map(n).filter(r);t.$$.on_destroy?t.$$.on_destroy.push(...e):o(e),t.$$.on_mount=[]})),a.forEach(E)}(c,i.target,i.anchor,i.customElement),S()}var x,b;y(m)}class T{$destroy(){O(this,1),this.$destroy=t}$on(n,e){if(!r(e))return t;const o=this.$$.callbacks[n]||(this.$$.callbacks[n]=[]);return o.push(e),()=>{const t=o.indexOf(e);-1!==t&&o.splice(t,1)}}$set(t){var n;this.$$set&&(n=t,0!==Object.keys(n).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}function F(t,n,e){const o=t.slice();return o[12]=n[e],o[14]=e,o}function q(t){let n,e;return{c(){var t,o;n=f("img"),t=n.src,o=e="loading.gif",i||(i=document.createElement("a")),i.href=o,t!==i.href&&h(n,"src","loading.gif"),h(n,"alt","loading")},m(t,e){u(t,n,e)},d(t){t&&l(n)}}}function z(t){let n,e;return{c(){n=f("p"),e=p(t[1])},m(t,o){u(t,n,o),a(n,e)},p(t,n){2&n&&m(e,t[1])},d(t){t&&l(n)}}}function I(t){let n,e,o,r,c,i,s=t[12].role+"",h=t[12].content+"";return{c(){n=f("p"),e=f("strong"),o=p(s),r=p(": "),c=p(h),i=d()},m(t,s){u(t,n,s),a(n,e),a(e,o),a(n,r),a(n,c),a(n,i)},p(t,n){16&n&&s!==(s=t[12].role+"")&&m(o,s),16&n&&h!==(h=t[12].content+"")&&m(c,h)},d(t){t&&l(n)}}}function J(n){let e,o,r,c,i,s,y,x,b,v,w,_,k,E,j,C,S,P,A,O,L,N,T,J,B,M,R,G,H=n[3]&&q(),K=!n[3]&&z(n),U=n[4],Y=[];for(let t=0;t<U.length;t+=1)Y[t]=I(F(n,U,t));return{c(){e=f("main"),o=f("h1"),o.textContent="s AI 藤さん",r=d(),c=f("div"),i=f("label"),s=f("span"),s.textContent="API キー",y=d(),x=f("input"),b=d(),v=f("div"),w=f("p"),w.textContent="あなた",_=d(),k=f("small"),k.textContent="スペースキーを押しながら喋ってください",E=d(),j=f("p"),C=p(n[0]),S=d(),P=f("div"),A=f("p"),A.textContent="わたし",O=d(),H&&H.c(),L=d(),K&&K.c(),N=d(),T=f("div"),T.innerHTML="<hr/>",J=d(),B=f("h2"),B.textContent="会話ログ",M=d();for(let t=0;t<Y.length;t+=1)Y[t].c();h(o,"class","svelte-1qrwe53"),$(s,"margin-right","16px"),h(x,"id","api-key"),h(i,"for","api-key"),$(w,"color","#FF0000"),$(w,"font-size","24px"),$(w,"margin-bottom","0px"),$(k,"color","gray"),$(v,"height","100px"),$(A,"color","#0000FF"),$(A,"font-size","24px"),$(P,"margin-top","48px"),$(P,"height","100px"),$(T,"margin-top","32px"),h(e,"id","main"),h(e,"class","svelte-1qrwe53")},m(t,l){u(t,e,l),a(e,o),a(e,r),a(e,c),a(c,i),a(i,s),a(i,y),a(i,x),g(x,n[2]),a(e,b),a(e,v),a(v,w),a(v,_),a(v,k),a(v,E),a(v,j),a(j,C),a(e,S),a(e,P),a(P,A),a(P,O),H&&H.m(P,null),a(P,L),K&&K.m(P,null),a(e,N),a(e,T),a(e,J),a(e,B),a(e,M);for(let t=0;t<Y.length;t+=1)Y[t]&&Y[t].m(e,null);var f,p,d,h;R||(f=x,p="input",d=n[5],f.addEventListener(p,d,h),G=()=>f.removeEventListener(p,d,h),R=!0)},p(t,[n]){if(4&n&&x.value!==t[2]&&g(x,t[2]),1&n&&m(C,t[0]),t[3]?H||(H=q(),H.c(),H.m(P,L)):H&&(H.d(1),H=null),t[3]?K&&(K.d(1),K=null):K?K.p(t,n):(K=z(t),K.c(),K.m(P,null)),16&n){let o;for(U=t[4],o=0;o<U.length;o+=1){const r=F(t,U,o);Y[o]?Y[o].p(r,n):(Y[o]=I(r),Y[o].c(),Y[o].m(e,null))}for(;o<Y.length;o+=1)Y[o].d(1);Y.length=U.length}},i:t,o:t,d(t){t&&l(e),H&&H.d(),K&&K.d(),function(t,n){for(let e=0;e<t.length;e+=1)t[e]&&t[e].d(n)}(Y,t),R=!1,G()}}}function B(t,n,e){let o=!1,r="",c="",i="",s=!1,a=[];class u{constructor(t,n){this.role=t,this.content=n}toObject(){return{role:this.role,content:this.content}}}const l=(()=>{const t=webkitSpeechRecognition||t,n=new t;return n.interimResults=!0,n.continuous=!0,n.lang="ja-JP",n})();return l.onresult=t=>{e(0,r=Object.keys(t.results).map((n=>t.results[n][0].transcript)).join())},window.addEventListener("keydown",(t=>{"Space"!==t.code||o||(o=!0,l.start())})),window.addEventListener("keyup",(async t=>{if("Space"===t.code){if(o=!1,l.stop(),a.push(new u("user",r)),e(4,a),e(3,s=!0),e(1,c=await(async t=>{if(""==i)return alert("ChatGPT の API KEY を設定してください"),"";const n=JSON.stringify({messages:t,model:"gpt-3.5-turbo"}),e=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:n});return(await e.json()).choices[0].message.content})(a)),e(3,s=!1),""==c)return void e(4,a=[]);a.push(new u("assistant",c)),e(4,a),(t=>{const n=new SpeechSynthesisUtterance;n.text=t,n.lang="ja-JP",n.rate=1.2,n.pitch=1,n.volume=1,window.speechSynthesis.speak(n)})(c)}})),[r,c,i,s,a,function(){i=this.value,e(2,i)}]}return new class extends T{constructor(t){super(),N(this,t,B,J,c,{})}}({target:document.body,props:{}})}();
//# sourceMappingURL=bundle.js.map
